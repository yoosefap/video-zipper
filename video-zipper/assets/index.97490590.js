var Oe=(o,e,n)=>{if(!e.has(o))throw TypeError("Cannot "+n)};var p=(o,e,n)=>(Oe(o,e,"read from private field"),n?n.call(o):e.get(o)),w=(o,e,n)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,n)},F=(o,e,n,s)=>(Oe(o,e,"write to private field"),s?s.call(o,n):e.set(o,n),n);var k=(o,e,n)=>(Oe(o,e,"access private method"),n);const st=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}};st();var He=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},at={exports:{}};(function(o){var e=function(n){var s=Object.prototype,a=s.hasOwnProperty,l=Object.defineProperty||function(r,t,i){r[t]=i.value},d,c=typeof Symbol=="function"?Symbol:{},h=c.iterator||"@@iterator",m=c.asyncIterator||"@@asyncIterator",v=c.toStringTag||"@@toStringTag";function y(r,t,i){return Object.defineProperty(r,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),r[t]}try{y({},"")}catch{y=function(t,i,f){return t[i]=f}}function P(r,t,i,f){var u=t&&t.prototype instanceof b?t:b,g=Object.create(u.prototype),L=new $e(f||[]);return l(g,"_invoke",{value:ot(r,i,L)}),g}n.wrap=P;function N(r,t,i){try{return{type:"normal",arg:r.call(t,i)}}catch(f){return{type:"throw",arg:f}}}var M="suspendedStart",Fe="suspendedYield",pe="executing",q="completed",j={};function b(){}function $(){}function E(){}var T={};y(T,h,function(){return this});var x=Object.getPrototypeOf,z=x&&x(x(Le([])));z&&z!==s&&a.call(z,h)&&(T=z);var K=E.prototype=b.prototype=Object.create(T);$.prototype=E,l(K,"constructor",{value:E,configurable:!0}),l(E,"constructor",{value:$,configurable:!0}),$.displayName=y(E,v,"GeneratorFunction");function De(r){["next","throw","return"].forEach(function(t){y(r,t,function(i){return this._invoke(t,i)})})}n.isGeneratorFunction=function(r){var t=typeof r=="function"&&r.constructor;return t?t===$||(t.displayName||t.name)==="GeneratorFunction":!1},n.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,E):(r.__proto__=E,y(r,v,"GeneratorFunction")),r.prototype=Object.create(K),r},n.awrap=function(r){return{__await:r}};function de(r,t){function i(g,L,S,_){var O=N(r[g],r,L);if(O.type==="throw")_(O.arg);else{var Se=O.arg,te=Se.value;return te&&typeof te=="object"&&a.call(te,"__await")?t.resolve(te.__await).then(function(D){i("next",D,S,_)},function(D){i("throw",D,S,_)}):t.resolve(te).then(function(D){Se.value=D,S(Se)},function(D){return i("throw",D,S,_)})}}var f;function u(g,L){function S(){return new t(function(_,O){i(g,L,_,O)})}return f=f?f.then(S,S):S()}l(this,"_invoke",{value:u})}De(de.prototype),y(de.prototype,m,function(){return this}),n.AsyncIterator=de,n.async=function(r,t,i,f,u){u===void 0&&(u=Promise);var g=new de(P(r,t,i,f),u);return n.isGeneratorFunction(t)?g:g.next().then(function(L){return L.done?L.value:g.next()})};function ot(r,t,i){var f=M;return function(g,L){if(f===pe)throw new Error("Generator is already running");if(f===q){if(g==="throw")throw L;return Ie()}for(i.method=g,i.arg=L;;){var S=i.delegate;if(S){var _=We(S,i);if(_){if(_===j)continue;return _}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(f===M)throw f=q,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);f=pe;var O=N(r,t,i);if(O.type==="normal"){if(f=i.done?q:Fe,O.arg===j)continue;return{value:O.arg,done:i.done}}else O.type==="throw"&&(f=q,i.method="throw",i.arg=O.arg)}}}function We(r,t){var i=t.method,f=r.iterator[i];if(f===d)return t.delegate=null,i==="throw"&&r.iterator.return&&(t.method="return",t.arg=d,We(r,t),t.method==="throw")||i!=="return"&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),j;var u=N(f,r.iterator,t.arg);if(u.type==="throw")return t.method="throw",t.arg=u.arg,t.delegate=null,j;var g=u.arg;if(!g)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,j;if(g.done)t[r.resultName]=g.value,t.next=r.nextLoc,t.method!=="return"&&(t.method="next",t.arg=d);else return g;return t.delegate=null,j}De(K),y(K,v,"Generator"),y(K,h,function(){return this}),y(K,"toString",function(){return"[object Generator]"});function it(r){var t={tryLoc:r[0]};1 in r&&(t.catchLoc=r[1]),2 in r&&(t.finallyLoc=r[2],t.afterLoc=r[3]),this.tryEntries.push(t)}function Ee(r){var t=r.completion||{};t.type="normal",delete t.arg,r.completion=t}function $e(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(it,this),this.reset(!0)}n.keys=function(r){var t=Object(r),i=[];for(var f in t)i.push(f);return i.reverse(),function u(){for(;i.length;){var g=i.pop();if(g in t)return u.value=g,u.done=!1,u}return u.done=!0,u}};function Le(r){if(r){var t=r[h];if(t)return t.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var i=-1,f=function u(){for(;++i<r.length;)if(a.call(r,i))return u.value=r[i],u.done=!1,u;return u.value=d,u.done=!0,u};return f.next=f}}return{next:Ie}}n.values=Le;function Ie(){return{value:d,done:!0}}return $e.prototype={constructor:$e,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(Ee),!r)for(var t in this)t.charAt(0)==="t"&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=d)},stop:function(){this.done=!0;var r=this.tryEntries[0],t=r.completion;if(t.type==="throw")throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var t=this;function i(_,O){return g.type="throw",g.arg=r,t.next=_,O&&(t.method="next",t.arg=d),!!O}for(var f=this.tryEntries.length-1;f>=0;--f){var u=this.tryEntries[f],g=u.completion;if(u.tryLoc==="root")return i("end");if(u.tryLoc<=this.prev){var L=a.call(u,"catchLoc"),S=a.call(u,"finallyLoc");if(L&&S){if(this.prev<u.catchLoc)return i(u.catchLoc,!0);if(this.prev<u.finallyLoc)return i(u.finallyLoc)}else if(L){if(this.prev<u.catchLoc)return i(u.catchLoc,!0)}else if(S){if(this.prev<u.finallyLoc)return i(u.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,t){for(var i=this.tryEntries.length-1;i>=0;--i){var f=this.tryEntries[i];if(f.tryLoc<=this.prev&&a.call(f,"finallyLoc")&&this.prev<f.finallyLoc){var u=f;break}}u&&(r==="break"||r==="continue")&&u.tryLoc<=t&&t<=u.finallyLoc&&(u=null);var g=u?u.completion:{};return g.type=r,g.arg=t,u?(this.method="next",this.next=u.finallyLoc,j):this.complete(g)},complete:function(r,t){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&t&&(this.next=t),j},finish:function(r){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===r)return this.complete(i.completion,i.afterLoc),Ee(i),j}},catch:function(r){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===r){var f=i.completion;if(f.type==="throw"){var u=f.arg;Ee(i)}return u}}throw new Error("illegal catch attempt")},delegateYield:function(r,t,i){return this.delegate={iterator:Le(r),resultName:t,nextLoc:i},this.method==="next"&&(this.arg=d),j}},n}(o.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(at);var lt={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let Ge=!1,Ye=()=>{};const ct=o=>{Ge=o},ut=o=>{Ye=o},ht=(o,e)=>{Ye({type:o,message:e}),Ge&&console.log(`[${o}] ${e}`)};var Ze={logging:Ge,setLogging:ct,setCustomLogger:ut,log:ht};let re=0,je=0;const Me=o=>{const[e,n,s]=o.split(":");return parseFloat(e)*60*60+parseFloat(n)*60+parseFloat(s)};var ft=(o,e)=>{if(typeof o=="string")if(o.startsWith("  Duration")){const n=o.split(", ")[0].split(": ")[1],s=Me(n);e({duration:s,ratio:je}),(re===0||re>s)&&(re=s)}else if(o.startsWith("frame")||o.startsWith("size")){const n=o.split("time=")[1].split(" ")[0],s=Me(n);je=s/re,e({ratio:je,time:s})}else o.startsWith("video:")&&(e({ratio:1}),re=0)},pt=(o,e)=>{const n=o._malloc(e.length*Uint32Array.BYTES_PER_ELEMENT);return e.forEach((s,a)=>{const l=o._malloc(s.length+1);o.writeAsciiToMemory(s,l),o.setValue(n+Uint32Array.BYTES_PER_ELEMENT*a,l,"i32")}),[e.length,n]},Re={exports:{}};(function(o,e){(function(n,s){o.exports=s()})(He,function(){function n(){var s=arguments.length;if(s===0)throw new Error("resolveUrl requires at least one argument; got none.");var a=document.createElement("base");if(a.href=arguments[0],s===1)return a.href;var l=document.getElementsByTagName("head")[0];l.insertBefore(a,l.firstChild);for(var d=document.createElement("a"),c,h=1;h<s;h++)d.href=arguments[h],c=d.href,a.href=c;return l.removeChild(a),c}return n})})(Re);const dt="@ffmpeg/ffmpeg",mt="0.10.1",gt="FFmpeg WebAssembly version",yt="src/index.js",vt="src/index.d.ts",wt={example:"examples"},bt={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Ft={"./src/node/index.js":"./src/browser/index.js"},Et={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},$t=["ffmpeg","WebAssembly","video"],Lt="Jerome Wu <jeromewus@gmail.com>",St="MIT",Ot={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},jt={node:">=12.16.1"},kt="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Pt={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},_t={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var Je={name:dt,version:mt,description:gt,main:yt,types:vt,directories:wt,scripts:bt,browser:Ft,repository:Et,keywords:$t,author:Lt,license:St,bugs:Ot,engines:jt,homepage:kt,dependencies:Pt,devDependencies:_t};const{devDependencies:xt}=Je;var Ct={corePath:`https://unpkg.com/@ffmpeg/core@${xt["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const At=Re.exports,{log:oe}=Ze,ke=async(o,e)=>{oe("info",`fetch ${o}`);const n=await(await fetch(o)).arrayBuffer();oe("info",`${o} file size = ${n.byteLength} bytes`);const s=new Blob([n],{type:e}),a=URL.createObjectURL(s);return oe("info",`${o} blob URL = ${a}`),a};var Nt=async({corePath:o})=>{if(typeof o!="string")throw Error("corePath should be a string!");const e=At(o),n=await ke(e,"application/javascript"),s=await ke(e.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),a=await ke(e.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(l=>{const d=document.createElement("script"),c=()=>{d.removeEventListener("load",c),oe("info","ffmpeg-core.js script loaded"),l({createFFmpegCore,corePath:n,wasmPath:s,workerPath:a})};d.src=n,d.type="text/javascript",d.addEventListener("load",c),document.getElementsByTagName("head")[0].appendChild(d)}):(oe("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:n,wasmPath:s,workerPath:a}))};const Tt=Re.exports,Ut=o=>new Promise((e,n)=>{const s=new FileReader;s.onload=()=>{e(s.result)},s.onerror=({target:{error:{code:a}}})=>{n(Error(`File could not be read! Code=${a}`))},s.readAsArrayBuffer(o)});var Bt=async o=>{let e=o;return typeof o=="undefined"?new Uint8Array:(typeof o=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?e=atob(o.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(Tt(o))).arrayBuffer():(o instanceof File||o instanceof Blob)&&(e=await Ut(o)),new Uint8Array(e))};const Gt=Ct,Rt=Nt,Dt=Bt;var Qe={defaultOptions:Gt,getCreateFFmpegCore:Rt,fetchFile:Dt};const{defaultArgs:Wt,baseOptions:It}=lt,{setLogging:qe,setCustomLogger:ze,log:W}=Ze,Mt=ft,qt=pt,{defaultOptions:zt,getCreateFFmpegCore:Kt}=Qe,{version:Vt}=Je,Pe=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var Ht=(o={})=>{const{log:e,logger:n,progress:s,...a}={...It,...zt,...o};let l=null,d=null,c=null,h=!1,m=s;const v=b=>{b==="FFMPEG_END"&&c!==null&&(c(),c=null,h=!1)},y=({type:b,message:$})=>{W(b,$),Mt($,m),v($)},P=async()=>{if(W("info","load ffmpeg-core"),l===null){W("info","loading ffmpeg-core");const{createFFmpegCore:b,corePath:$,workerPath:E,wasmPath:T}=await Kt(a);l=await b({mainScriptUrlOrBlob:$,printErr:x=>y({type:"fferr",message:x}),print:x=>y({type:"ffout",message:x}),locateFile:(x,z)=>{if(typeof window!="undefined"){if(typeof T!="undefined"&&x.endsWith("ffmpeg-core.wasm"))return T;if(typeof E!="undefined"&&x.endsWith("ffmpeg-core.worker.js"))return E}return z+x}}),d=l.cwrap("proxy_main","number",["number","number"]),W("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},N=()=>l!==null,M=(...b)=>{if(W("info",`run ffmpeg command: ${b.join(" ")}`),l===null)throw Pe;if(h)throw Error("ffmpeg.wasm can only run one command at a time");return h=!0,new Promise($=>{const E=[...Wt,...b].filter(T=>T.length!==0);c=$,d(...qt(l,E))})},Fe=(b,...$)=>{if(W("info",`run FS.${b} ${$.map(E=>typeof E=="string"?E:`<${E.length} bytes binary file>`).join(" ")}`),l===null)throw Pe;{let E=null;try{E=l.FS[b](...$)}catch{throw Error(b==="readdir"?`ffmpeg.FS('readdir', '${$[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:b==="readFile"?`ffmpeg.FS('readFile', '${$[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return E}},pe=()=>{if(l===null)throw Pe;h=!1,l.exit(1),l=null,d=null,c=null},q=b=>{m=b},j=b=>{ze(b)};return qe(e),ze(n),W("info",`use ffmpeg.wasm v${Vt}`),{setProgress:q,setLogger:j,setLogging:qe,load:P,isLoaded:N,run:M,exit:pe,FS:Fe}};const Yt=Ht,{fetchFile:Zt}=Qe;var Ke={createFFmpeg:Yt,fetchFile:Zt},C,Y,Z,se,ae,I,le,A,G,J,Q,ce,X,ee,U,ue,R,V,he,Ae,ye,Xe,ve,et,fe,Ne,we,tt;class Jt{constructor(e={},n=!1){w(this,R);w(this,he);w(this,ye);w(this,ve);w(this,fe);w(this,we);w(this,C,void 0);w(this,Y,void 0);w(this,Z,void 0);w(this,se,!1);w(this,ae,"medium");w(this,I,void 0);w(this,le,"output");w(this,A,"mp4");w(this,G,null);w(this,J,void 0);w(this,Q,void 0);w(this,ce,void 0);w(this,X,void 0);w(this,ee,void 0);w(this,U,void 0);w(this,ue,{veryHigh:{name:"Very High",mp4:12,webm:18},high:{name:"High",mp4:18,webm:24},medium:{name:"Medium",mp4:23,webm:29},low:{name:"Low",mp4:28,webm:32},veryLow:{name:"Very Low",mp4:34,webm:38}});F(this,ae,e.quality||"medium"),F(this,I,e.crf||null),F(this,J,e.progress||null),F(this,ce,e.success||null),F(this,Q,e.start||null),F(this,X,e.end||null),F(this,ee,e.fail||null),F(this,le,e.name||"output"),F(this,U,Ke.createFFmpeg({log:!0,progress:s=>k(this,he,Ae).call(this,s.ratio)})),n&&this.load()}progress(e){F(this,J,e)}start(e){F(this,Q,e)}end(e){F(this,X,e)}fail(e){F(this,ee,e)}async load(){await p(this,U).load(),F(this,se,!0)}async compress(e,n=null){if(!p(this,se)){console.error("FFmpeg isn't loaded yet");return}F(this,G,n||k(this,we,tt).call(this)),k(this,R,V).call(this,p(this,Q),this),k(this,he,Ae).call(this,0),k(this,ye,Xe).call(this,e);try{p(this,U).FS("writeFile",p(this,C).name,await Ke.fetchFile(p(this,C))),p(this,A)==="webm"?await p(this,U).run("-i",p(this,C).name,"-c:v","libvpx-vp9","-crf",k(this,fe,Ne).call(this),"-b:v","0","-row-mt","1",`${p(this,G)}`):await p(this,U).run("-i",p(this,C).name,"-c:v","libx264","-crf",k(this,fe,Ne).call(this),`${p(this,G)}`);const s=p(this,U).FS("readFile",p(this,G));F(this,Z,new Blob([s.buffer],{type:`video/${p(this,A)}`})),F(this,Y,URL.createObjectURL(p(this,Z)))}catch(s){console.error(s),k(this,R,V).call(this,p(this,ee),s)}return k(this,R,V).call(this,p(this,ce),this),k(this,R,V).call(this,p(this,X),this),this}download(){const e=document.createElement("a");e.href=p(this,Y),e.target="_blank",e.download=p(this,G),e.click()}getUrl(){return p(this,Y)}getBlob(){return p(this,Z)}getMainFile(){return p(this,C)}}C=new WeakMap,Y=new WeakMap,Z=new WeakMap,se=new WeakMap,ae=new WeakMap,I=new WeakMap,le=new WeakMap,A=new WeakMap,G=new WeakMap,J=new WeakMap,Q=new WeakMap,ce=new WeakMap,X=new WeakMap,ee=new WeakMap,U=new WeakMap,ue=new WeakMap,R=new WeakSet,V=function(e,n=null){e&&n!==null?e(n):e&&e()},he=new WeakSet,Ae=function(e){const n=Math.round(e*100);k(this,R,V).call(this,p(this,J),n)},ye=new WeakSet,Xe=function(e){F(this,C,e),F(this,A,p(this,C).name.split(".").pop())},ve=new WeakSet,et=function(){return p(this,ue)[p(this,ae)]||null},fe=new WeakSet,Ne=function(){if(p(this,I)&&Number.isInteger(p(this,I)))return p(this,I).toString();const e=k(this,ve,et).call(this);return e&&e[p(this,A)]?e[p(this,A)].toString():p(this,ue).medium[p(this,A)].toString()},we=new WeakSet,tt=function(){return`${p(this,le)}.${p(this,A)}`};var rt={exports:{}};(function(o,e){(function(n,s){o.exports=s()})(He,function(){const n=(c,h,m,v)=>{const y=(h*m+2*c)/m**3,P=-(2*h*m+3*c)/m**2,N=h,M=c;return y*v**3+P*v**2+N*v+M},s=(c,h,m,v)=>{const y=(h*m+2*c)/m**3,P=-(2*h*m+3*c)/m**2,N=h;return 3*y*v**2+2*P*v+N},a=function(c,h){Object.entries(typeof c=="number"?{value:c}:c).map(([v,y])=>h(y,v))};function l(c,h){this.start=new Date/1e3,this.time=h,this.from=c,this.current=c,this.to=c,this.speed=0}l.prototype.get=function(c){const h=c/1e3-this.start;if(h<0)throw new Error("Cannot read in the past");return h>=this.time?this.to:this.to-n(this.to-this.from,this.speed,this.time,h)},l.prototype.getSpeed=function(c){const h=c/1e3-this.start;return h>=this.time?0:s(this.to-this.from,this.speed,this.time,h)},l.prototype.set=function(c,h){const m=new Date,v=this.get(m);return this.speed=this.getSpeed(m),this.start=m/1e3,this.from=v,this.to=c,h&&(this.time=h),v};function d(c,h=300){return typeof c=="number"&&(c={value:c}),a(c,(m,v)=>{const y=new l(m,h/1e3);Object.defineProperty(c,"_"+v,{value:y}),Object.defineProperty(c,"$"+v,{get:()=>y.to}),Object.defineProperty(c,v,{get:()=>y.get(new Date),set:P=>y.set(P),enumerable:!0})}),Object.defineProperty(c,"get",{get:()=>function(m="value",v=new Date){return this["_"+m].get(v)}}),Object.defineProperty(c,"set",{get:()=>function(m,v=0){a(m,(y,P)=>{this["_"+P].set(y,v/1e3)})}}),c}return d})})(rt);var Ve=rt.exports;const Qt=(o,e)=>o[e%o.length],_e=(o,e)=>{Object.keys(e).forEach(n=>o.style[n]=e[n])},xe=Symbol("_values"),B=Symbol("_interpolated"),ne=Symbol("_text"),ie=Symbol("_update"),nt=Symbol("_lastUpdate"),ge=Symbol("_animationFrame"),Ce="circular-progress-bar";class be{constructor(e=0,n){this.options={...be.defaultOptions,...n},this.node=document.createElement("div"),this.node.className=Ce,_e(this.node,{width:`${this.options.size}px`,height:`${this.options.size}px`});const s=document.createElement("div");s.className=`${Ce}_value`;const a=(100-this.options.barsWidth)/100*this.options.size;_e(s,{background:this.options.valueBackground,width:`${a}px`,height:`${a}px`,top:`${this.options.barsWidth/2}%`,left:`${this.options.barsWidth/2}%`}),this.node.appendChild(s),this[ne]=document.createElement("div"),this[ne].className=`${Ce}_value_text`,_e(this[ne],{lineHeight:`${a}px`,fontSize:`${a/3}px`}),s.appendChild(this[ne]);const l=Array.isArray(e)?e:[e];this[B]=Ve(l),this[ie]=this[ie].bind(this),this.values=l}get value(){return this.values[0]}get values(){return this[xe]}set value(e){this.values=[e]}set values(e){if(this[xe]=e,e.length!==this[B].length){const a=new Date,l=this[B].map((c,h)=>this[B][`_${h}`]);for(;l.length&&l[l.length-1].get(a)===0;)l.length-=1;const{length:d}=l;this[B]=Ve(new Array(Math.max(d,e.length)).fill(0));for(let c=0;c<d;++c){const h=l[c],m=this[B][`_${c}`];m.time=0,m.to=h.get(a)}e.push(...new Array(Math.max(0,d-e.length)).fill(0))}this[B].set(e,this.options.transitionTime),this[nt]=performance.now(),this[ge]=this[ie](0);const n=this[xe].reduce((a,l)=>a+l,0);let s="";if(n>=this.options.max&&this.options.valueWhenDone)s=this.options.valueWhenDone;else{let a=this.values.length>1?n:this.values[0];this.options.valueUnit==="%"&&(a/=this.options.max/100),s=`${a.toFixed(this.options.valueDecimals)}${this.options.valueUnit}`}this.options.showValue&&(this[ne].textContent=s)}appendTo(e){e.appendChild(this.node)}remove(){this.node.remove()}static get defaultOptions(){return{size:150,barsWidth:20,max:100,showValue:!0,valueDecimals:0,valueUnit:"%",valueBackground:"#333",colors:["#0484d1","#e53b44","#2ce8f4","#ffe762","#63c64d","#fb922b"],background:"rgba(0, 0, 0, .3)",transitionTime:500,valueWhenDone:null}}}be.prototype[ie]=function(e){if(e>this[nt]+this.options.transitionTime)return;this[ge]&&cancelAnimationFrame(this[ge]),this[ge]=requestAnimationFrame(this[ie]);let n=0;const s=this[B].map((a,l)=>{const d=a/this.options.max*100;if(d<.1)return null;const c=`${Qt(this.options.colors,l)} ${n}% ${n+d}%`;return n+=d+.1,c}).filter(a=>a);n<100&&s.push(`transparent ${n}% 100%`),this.node.style.background=`conic-gradient(${s.join(",")}) ${this.options.background}`};let H=new Jt({quality:"low"});H.load().then(()=>{console.log("loaded"),document.getElementById("loading").style.display="none"});let Te=document.getElementById("progress"),Ue=document.getElementById("download"),me=document.getElementById("preview");const Be=new be;Be.appendTo(Te);document.getElementById("file").addEventListener("input",o=>{let e=o.target.files[0];H.start(()=>{Ue.style.display="none",me.style.display="none",Te.style.display="block",Be.value=0}),H.progress(n=>{console.log(n.toString()+"%"),Be.value=n}),H.compress(e).then(n=>{Te.style.display="none",me.src=H.getUrl(),me.play(),me.style.display="block",Ue.style.display="block"})});Ue.addEventListener("click",()=>{H.download()});
